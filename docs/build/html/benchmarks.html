<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Benchmarks &mdash; CHarm 0.2.0-dev documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom_BB.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tested platforms" href="platforms.html" />
    <link rel="prev" title="pyharm.glob" href="api-py-glob.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CHarm
              <img src="_static/charm-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.2.0-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="definitions.html">Some definitions to make things clear</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Interfaces</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Benchmarks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#accuracy">Accuracy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#speed">Speed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#memory">Memory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="platforms.html">Tested platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CHarm</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Benchmarks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/benchmarks.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="benchmarks">
<h1>Benchmarks<a class="headerlink" href="#benchmarks" title="Permalink to this heading"></a></h1>
<p>This section demonstrates the accuracy, the computation speed and the memory
requirements of spherical harmonic analysis and synthesis of point data values.
Applied is the Gauss–Legendre quadrature, which offers the best performance.
All tests were executed on a PC with the Intel(R) Core(TM) i7-6800K CPU
&#64; 3.40GHz and 128 GBs of RAM.  CHarm was compiled using <code class="docutils literal notranslate"><span class="pre">GCC</span></code> with
<code class="docutils literal notranslate"><span class="pre">--enable-openmp</span></code>, <code class="docutils literal notranslate"><span class="pre">--enable-avx</span></code> and <code class="docutils literal notranslate"><span class="pre">CFLAGS=&quot;-O3</span> <span class="pre">-ffast-math&quot;</span></code>
installation flags.  All 6 CPU cores were employed with hyperthreading enabled.</p>
<p>The benchmarks can be executed by <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">bench</span></code> after running <code class="docutils literal notranslate"><span class="pre">./configure</span></code>
and <code class="docutils literal notranslate"><span class="pre">make</span></code>.  The outputs from the benchmark program (the accuracy and
wall-clock times) can be plotted by a Python script <code class="docutils literal notranslate"><span class="pre">plot-bench.py</span></code> inside
the <code class="docutils literal notranslate"><span class="pre">bench</span></code> folder (requires <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>).  The memory
requirements can be plotted by the <code class="docutils literal notranslate"><span class="pre">plot-memory.py</span></code> script that can be found
inside the same directory.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The benchmark program may require up 56 GBs of RAM!  Do not execute it if
you do not have that much RAM available. Alternatively, modify the
<code class="docutils literal notranslate"><span class="pre">nmax_all</span></code> array inside <code class="docutils literal notranslate"><span class="pre">./bench/bench.c</span></code>.</p>
</div>
<section id="accuracy">
<span id="id1"></span><h2>Accuracy<a class="headerlink" href="#accuracy" title="Permalink to this heading"></a></h2>
<p>We generated reference random spherical harmonic coefficients from the interval
<code class="docutils literal notranslate"><span class="pre">[-1.0,</span> <span class="pre">1.0]</span></code> up to degree <code class="docutils literal notranslate"><span class="pre">N</span></code>, then synthesized the signal up to degree
<code class="docutils literal notranslate"><span class="pre">N</span></code>, and, finally, harmonically analyzed the signal
up to the same <code class="docutils literal notranslate"><span class="pre">N</span></code> degree.  Below are plotted the following statistics
obtained from the differences between the recovered and the reference
coefficients:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\varepsilon_{\max} = \max_{n,m}|\bar{Q}_{nm}
- \bar{Q}^{(\mathrm{ref})}_{nm}|\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\varepsilon_\mathrm{rms} = \sqrt{\frac{2}{(N + 1) (N + 2)} \,
\sum_{n,m} \left(\bar{Q}_{nm} - \bar{Q}^{(\mathrm{ref})}_{nm} \right)^2}\)</span>.</p></li>
</ul>
<p><strong>Single precision</strong></p>
<p>In single precision, the tests are conducted up to <code class="docutils literal notranslate"><span class="pre">N</span> <span class="pre">=</span> <span class="pre">7200</span></code> only.
Somewhere beyond that degree, it becomes difficult to compute the nodes of the
Gauss–Legendre quadrature without an overflow in single precision.  The
Driscoll–Healy quadrature could be used as an alternative, but this would
produce heterogeneous tests.</p>
<img alt="_images/benchf-accuracy.png" src="_images/benchf-accuracy.png" />
<p><strong>Double precision</strong></p>
<p><em>Polar optimization disabled (default)</em></p>
<img alt="_images/bench-accuracy.png" src="_images/bench-accuracy.png" />
<p><em>Polar optimization enabled</em> (<code class="docutils literal notranslate"><span class="pre">charm_glob_polar_optimization_a1</span> <span class="pre">=</span> <span class="pre">100</span></code>,
<code class="docutils literal notranslate"><span class="pre">charm_glob_polar_optimization_a2</span> <span class="pre">=</span> <span class="pre">0.01</span></code>).  Comparing this figure and the
previous one, it is seen that even though the polar optimization introduces
<em>approximations</em> to spherical harmonic transforms, the numerical accuracy is
the same.  The small differences between the two figures are caused by the fact
that a new set random spherical harmonic coefficients was generated in both
experiments.</p>
<img alt="_images/bench-po-accuracy.png" src="_images/bench-po-accuracy.png" />
<p><strong>Quadruple precision</strong></p>
<img alt="_images/benchq-accuracy.png" src="_images/benchq-accuracy.png" />
</section>
<section id="speed">
<h2>Speed<a class="headerlink" href="#speed" title="Permalink to this heading"></a></h2>
<p>The figures that follow plot the wall-clock times needed to perform spherical
harmonic synthesis and analysis in the experiments from the <a class="reference internal" href="#accuracy"><span class="std std-ref">Accuracy</span></a>
section.</p>
<p><strong>Single precision</strong></p>
<img alt="_images/benchf-time.png" src="_images/benchf-time.png" />
<p><strong>Double precision</strong></p>
<p><em>Polar optimization disabled (default)</em></p>
<img alt="_images/bench-time.png" src="_images/bench-time.png" />
<p><em>Using the polar optimization</em> (<code class="docutils literal notranslate"><span class="pre">charm_glob_polar_optimization_a1</span> <span class="pre">=</span> <span class="pre">100</span></code>,
<code class="docutils literal notranslate"><span class="pre">charm_glob_polar_optimization_a2</span> <span class="pre">=</span> <span class="pre">0.01</span></code>), the performance improved by about
25 percent, while the accuracy remains the same (see above).  More aggressive
polar optimization can further improve the performance, but, after some
critical point, only at the cost of deteriorated accuracy.</p>
<img alt="_images/bench-po-time.png" src="_images/bench-po-time.png" />
<p><strong>Quadruple precision</strong></p>
<img alt="_images/benchq-time.png" src="_images/benchq-time.png" />
</section>
<section id="memory">
<h2>Memory<a class="headerlink" href="#memory" title="Permalink to this heading"></a></h2>
<p>The next figure shows theoretical memory requirements for spherical harmonic
analysis/synthesis of point data values sampled at the Gauss–Legendre grid.
The values were computed for single, double and quadruple precision as (GBs)</p>
<div class="math notranslate nohighlight">
\[\left((N + 1) \, (2 \, N + 2) + (N + 1)^2 \right) \, \frac{B}{1024^3}{,}\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(N\)</span> is the maximum harmonic degree, which determines the size of arrays
to store the input data grid, <span class="math notranslate nohighlight">\((N + 1) \,  (2 \, N + 2)\)</span>, and the
spherical harmonic coefficients, <span class="math notranslate nohighlight">\({\sim}(N + 1)^2\)</span>, and</p></li>
<li><p><span class="math notranslate nohighlight">\(B\)</span> is the number of bytes needed to store a single <code class="docutils literal notranslate"><span class="pre">float</span></code>,
<code class="docutils literal notranslate"><span class="pre">double</span></code> or <code class="docutils literal notranslate"><span class="pre">__float128</span></code> floating point value (here assumed <code class="docutils literal notranslate"><span class="pre">4</span></code>, <code class="docutils literal notranslate"><span class="pre">8</span></code>
and <code class="docutils literal notranslate"><span class="pre">16</span></code> Bytes, respectively).</p></li>
</ul>
<p>Although these are theoretical requirements, they model the reality very well,
as all the remaining arrays are significantly smaller.</p>
<img alt="_images/bench-memory.png" src="_images/bench-memory.png" />
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api-py-glob.html" class="btn btn-neutral float-left" title="pyharm.glob" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="platforms.html" class="btn btn-neutral float-right" title="Tested platforms" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Blažej Bucha.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>